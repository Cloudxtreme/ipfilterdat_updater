#!/bin/bash
#  ipfilterdat-updater
#  
#  Copyright 2015 loxdegio <loxdegio@hotmail.com>
#  
#  This program is free software; you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation; either version 2 of the License, or
#  (at your option) any later version.
#  
#  This program is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#  GNU General Public License for more details.
#  
#  You should have received a copy of the GNU General Public License
#  along with this program; if not, write to the Free Software
#  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
#  MA 02110-1301, USA.
#  
#

tmpdir=/tmp/ipfilter
destdir=~/.aMule

mkdir $tmpdir

wget http://upd.emule-security.org/ipfilter.zip -O $tmpdir/ipfilter.zip
unzip $tmpdir/ipfilter.zip -d $tmpdir
cat $tmpdir/guarding.p2p | grep -v '#' >> $tmpdir/ipfilter_dat.tmp
wget http://up.sur-la-toile.com/i1cde -O $tmpdir/ipfilter.7z
7z e -so $tmpdir/ipfilter.7z | grep -v '#' >> $tmpdir/ipfilter_dat.tmp
wget http://tools.pervii.com/cn/ipfilter.dat.txt -O $tmpdir/ipfilter_dat-cn.txt
cat $tmpdir/ipfilter_dat-cn.txt | grep -v '#' >> $tmpdir/ipfilter_dat.tmp
wget http://tools.pervii.com/eu/ipfilter.dat.txt -O $tmpdir/ipfilter_dat-eu.txt
cat $tmpdir/ipfilter_dat-eu.txt | grep -v '#' >> $tmpdir/ipfilter_dat.tmp
wget http://tools.pervii.com/hk/ipfilter.dat.txt -O $tmpdir/ipfilter_dat-hk.txt
cat $tmpdir/ipfilter_dat-hk.txt | grep -v '#' >> $tmpdir/ipfilter_dat.tmp
wget http://tools.pervii.com/it/ipfilter.dat.txt -O $tmpdir/ipfilter_dat-it.txt
cat $tmpdir/ipfilter_dat-it.txt | grep -v '#' >> $tmpdir/ipfilter_dat.tmp
wget http://tools.pervii.com/jp/ipfilter.dat.txt -O $tmpdir/ipfilter_dat-jp.txt
cat $tmpdir/ipfilter_dat-jp.txt | grep -v '#' >> $tmpdir/ipfilter_dat.tmp
wget http://tools.pervii.com/kp/ipfilter.dat.txt -O $tmpdir/ipfilter_dat-kp.txt
cat $tmpdir/ipfilter_dat-kp.txt | grep -v '#' >> $tmpdir/ipfilter_dat.tmp
wget http://tools.pervii.com/kr/ipfilter.dat.txt -O $tmpdir/ipfilter_dat-kr.txt
cat $tmpdir/ipfilter_dat-kr.txt | grep -v '#' >> $tmpdir/ipfilter_dat.tmp
wget http://tools.pervii.com/ru/ipfilter.dat.txt -O $tmpdir/ipfilter_dat-ru.txt
cat $tmpdir/ipfilter_dat-ru.txt | grep -v '#' >> $tmpdir/ipfilter_dat.tmp
wget http://tools.pervii.com/us/ipfilter.dat.txt -O $tmpdir/ipfilter_dat-us.txt
cat $tmpdir/ipfilter_dat-us.txt | grep -v '#' >> $tmpdir/ipfilter_dat.tmp

echo '## Generated by ipfilterdat-updater script' > $destdir/ipfilter_dat.tmp

cat $tmpdir/ipfilter_dat.tmp | sort | uniq | grep -v 'file binario' > $tmpdir/ipfilter_dat.tmp1
echo "## Filtrati $(cat $tmpdir/ipfilter_dat.tmp1 | wc -l) IP" >> $destdir/ipfilter_dat.tmp

cat $tmpdir/ipfilter_dat.tmp1 >> $destdir/ipfilter_dat.tmp

mv $destdir/ipfilter{_dat.tmp,.dat}

rm -rf $tmpdir
